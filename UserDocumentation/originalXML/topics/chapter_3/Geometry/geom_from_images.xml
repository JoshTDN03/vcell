<?xml version="1.0" encoding="UTF-8"?>
<!--
	<link target = "target"> put your link here </link>
	<imgReference target = "target"/>
	<def target = "target"> put your link here </def>
    
    NOTE: introduction is required. 
          Please save your file as ".xml" in to VCell/UserDocumentation/your chapter name.
          Please be noted no space and special chars are allowed in the file name. 
          Please name your target as the file name(you are linking to) without extension. (e.g to set a link to Phys_Struct.html, you write target = "Phys_Struct"). 
          Before you commit, please try it out in browser first.
-->
<vcelldoc>
<page title="Creating image-based geometries in VCell">

	
	<introduction>
	Image-based geometries are created in VCell using the Image Geometry Editor, which is accessible from both BioModel and MathModel workspaces. 
	The Editor includes tools for constructing irregular geometries manually or from images obtained outside the VCell environment (e.g. digital microscopy).
	</introduction>
	
	<appearance>
	<imgReference target = "Geom_edit_new.gif"/>
	</appearance>
	
	<operations>
	<para>
	Begin creating an image based geometry by navigating to the Geometry Viewer: Click (Navigation panel)Applications->Application:"name"->Geometry->(View panel)->"Geometry" tab->"Geometry Definition" tab.
	</para>
	<para>
	To create a NEW image based geometry click "Add/Replace Geometry" button->choose "New..."->select from the list that appears:
	<list>
	<item>Image based (import from file, zip or directory) - (Use external image file as pre-segmented or template for compartment definition).</item>
	<item>From scratch - (Blank canvas for manual "painting" of compartment domains).</item>
	<item>Mesh based - (import from .stl file).</item>
	<item>Image based (legacy from database, not generally used) - (Re-use old images saved in earlier version of VCell).</item>
	</list>
	The image based geometry editor will appear and you can begin editing.
	</para>
	<para>
	To COPY an image based geometry from a saved BioModel, MathModel or Geometry click "Add/Replace Geometry" button->choose "Open from..."->select from the list that appears:
	<list>
	<item>BioModel names (select geometry from a previously saved BioModel).</item>
	<item>MathModel names (select geometry from a previously saved MathModel).</item>
	<item>Geometry names. (legacy from database, not generally used) - (Re-use old geometries saved in earlier version of VCell).</item>
	</list>
	The chosen geometry will immediately replace the current geometry in the application.  To edit the new geometry click the "Replace Geometry" button->choose "New..."->select "Edit Current Geometry".
	The image based geometry editor will appear and you can begin editing.
	</para>
	
	<para>	
	The overall segmentation process generally begins by clicking the "Add Domain..." button (see (B) in figure) to add an ROI name for each domain (compartment) in the final geometry.  
	The user enters an ROI name and a color is assigned that will be used to paint changes onto the editing canvas when user actions occur.  
	When working with an imported image, the user can crop it to select the appropriate working area (D) and adjust brightness and magnification (C) to clearly display the image before defining ROIs. 
	This is illustrated by the  first two frames in the series of snapshots at the bottom of figure that demonstrates, stage by stage, how an uploaded noisy image is transformed into a model geometry. 
	In the example figure, two spatial compartments are represented by the two corresponding ROIs.
	</para>
	<para>
	 Images that are not pre-segmented often require "smoothing" (blurring) in order to reduce random intensity variations (noise), which otherwise might make thresholding of image intensities less effective.  
	 The smoothing slider tool applies a filter to the imported image that reduces random noise (E).  
	 If after smoothing the image retains sufficient clarity and definition, the histogram thresholding tool can be applied to select intensity values that will define the currently active ROI (F). 
	 This tool allows the user to quickly paint the editing canvas at appropriate locations in all z-slices.  
	 Manual painting can be used to add, clean up or enhance ROIs after applying the histogram tool on an imported image or when the user is creating irregular geometry without an imported image (G).  
	 The final step in the segmentation process is to review the "Domain Regions" list that is automatically created as the user edits the geometry (H). 
	 This "Domain Regions" list identifies the size and location of all contiguous domain regions that have so far been defined in the editing canvas and provides a clear view of the current editing state.  
	 Without the "Domain Regions" list, it would be difficult to detect small discrepancies in ROI editing, which may lead to a fragmented or inappropriate final geometry unintended by the user.  
	 The histogram thresholding tool (F), manual paint (G) and domain regions (H) can be repeated as necessary to create all the ROIs that are appropriate for the desired geometry.  
	 Clicking the "Finish" button completes the process of transforming the editing canvas into a valid VCell geometry while allowing the user a chance to continue editing if any errors are encountered. Below, 
	 the tools for histogram thresholding and resolving regions are described in more details.
	</para>
	<para>
	The histogram thresholding tool (F) helps segment an imported image by grouping areas of an image on the basis of their pixel values (a histogram of image intensities will appear below the image geometry editing canvas). 
	This tool is especially helpful when the imported image files have multiple image z-slices  representing three-dimensional (3D) information.  
	Manual segmentation of 3D images is tedious and difficult, given that only one z-slice can be viewed at a time. 
	Thresholding of image values is usually effective because structurally related areas of the imported image have close pixel values since they are created similarly during the image generation process (e.g. microscope images from cells stained to enhance cytoplasm or nucleus).  
	Clicking or dragging the mouse horizontally across the histogram display selects a range of pixel values throughout an imported image, that, grouped together, define a portion corresponding to the currently active ROI.  
	Histogram selections are highlighted in the editing canvas and can be applied permanently (painted) by pressing the "Apply..." button.
	</para>
	<para>
	The "Domain Regions" list is continually updated as editing occurs and displays a list of all contiguous domain regions which are currently defined (painted) in the editing canvas.
	Clicking on one or more entries in the "Domain Regions" list will highlight the associated domain region pixels in the image canvas.  Similarly, using the domain region pick tool (I)
	allows the user to select one or more regions in the image canvas (click/shift-click) that will also be highlighted in the "Domain Regions" list.
	Thresholding and manual editing often leave regions in the editing canvas that are inappropriate and the "Domain Regions" list allows the user to select one or more 
	domain regions and merge them with their neighbors (Auto-Merge). 
	A neighbor is a domain region immediately adjacent to (touching) another domain region in the editing canvas. 
	Thus, merging allows the user to effectively paint several discrete areas of the editing canvas at once, by selecting from the "Domain Regions" list and pressing "Auto-Merge".  
	It replaces (overwrites) the selected domain region paint value with its neighbor domain region paint value.  
	Depending on the selections made in the "Domain Regions" list, "Auto-Merge" can add or remove domain region paint throughout the editing canvas in one easy operation.
	Right-clicking (mouse menu action) on any domain region selection within the "Domain Regions" list or the image canvas will pop-up a menu that allows the user to convert the selected domain regions
	into any other domain region by selecting from the pop-up menu list.  This "Convert selected regions to Domain" function provides another quick way to edit domain regions in the image canvas.
	</para>
	<para>
	The "origin" and "size" of the geometry can be edited by clicking the "Attributes..." button.  The "origin" defines where the first defined geometry point exists in simulation world space.
	The "size" defines the total length of the geometry in each axis (XYZ) in simulation world space.  The length can be entered per image pixel or total.
	The origin and size can also be set after the geometry is finished and applied to an application. (Application->Geometry Definition->Edit Domain... ) (described elsewhere).
	</para>
	</operations>
	
	<comments>  </comments>

</page>

</vcelldoc>