#!/usr/bin/env bash

#
# build_installers.sh can be run with regular installation of Install4J or within 
# run with a Linux Vagrant guest OS.  When run as Vagrant, the guest OS only has access
# to directories which are specifically mapped in the Vagrantfile.
#
# default definitions (see the Vagrantfile):

shopt -s -o nounset

#
# execute include file generated by deploy.sh script.
#
deploySettingsIncludeFile=$1
. $deploySettingsIncludeFile

secretsFile=$i4j_pathto_secretsDir/deploySecrets.include

if [ ! -e $secretsFile ]; then
	echo "secrets file not found"
	exit -1
fi

. $secretsFile


cd $i4j_pathto_mavenRootDir

if [ "$install_jres_into_user_home" = true ]; then
	mkdir -p $HOME/.install4j6/jres
	cp $i4j_pathto_jreDir/* $HOME/.install4j6/jres/
fi

#
# install Install4J product key (only really needed first time when using Vagrant)
#
$i4j_pathto_install4jc -L $vcell_secrets_I4J_licenseKey

#
# run install4jc to create installers for VCell Client on supported platforms.
#
$i4j_pathto_install4jc \
	--win-keystore-password=$vcell_secrets_winKeystorePassword \
	--mac-keystore-password=$vcell_secrets_macKeystorePassword \
	-D \
vcellIcnsFile=$compiler_vcellIcnsFile,\
mavenRootDir=$compiler_mavenRootDir,\
macKeystore=$i4j_pathto_secretsDir/$vcell_secrets_macKeystore_filename,\
winKeystore=$i4j_pathto_secretsDir/$vcell_secrets_winKeystore_filename,\
applicationId=$compiler_applicationId,\
SoftwareVersionString=$compiler_softwareVersionString,\
Site=$compiler_Site,\
vcellVersion=$compiler_vcellVersion,\
vcellBuild=$compiler_vcellBuild,\
updateSiteBaseUrl=$compiler_updateSiteBaseUrl,\
vcellClientJarFileSourcePath=$compiler_vcellClientJarFilePath,\
rmiHosts=$compiler_rmiHosts,\
bioformatsJarFile=$compiler_bioformatsJarFile,\
bioformatsJarDownloadURL=$compiler_bioformatsJarDownloadURL\
	$i4j_pathto_install4JFile

