bleachThreshold = 0.80
cellThreshold = 0.5
vfrapFile = file("d:\\Developer\\eclipse\\workspace_refactor\\VCell_5.4_clean\\vfrapPaper\\rawData\\sim3\\workflow.txt.save")
uniformDisk2ModelName = "KenworthyUniformDisk2Param"
uniformDisk2PanelTitle = "Uniform Disk Model - 2 parameters"
uniformDisk3ModelName = "KenworthyUniformDisk3Param"
uniformDisk3PanelTitle = "Uniform Disk Model - 3 parameters"
prebleachFluor = 10


importVFrap = ImportRawTimeSeriesFromVFrap()
	importVFrap.vfrapFile = vfrapFile
	

generateCellROIs = GenerateCellROIsFromRawTimeSeries()
	generateCellROIs.rawTimeSeriesImages = importVFrap.rawTimeSeriesImages
	generateCellROIs.cellThreshold = cellThreshold
	
generateNormalizedFrapData = GenerateNormalizedFrapData()
	generateNormalizedFrapData.rawImageTimeSeries = importVFrap.rawTimeSeriesImages
	generateNormalizedFrapData.backgroundROI_2D = generateCellROIs.backgroundROI_2D
	generateNormalizedFrapData.indexOfFirstPostbleach = generateCellROIs.indexOfFirstPostbleach

generateROIs = GenerateBleachROI()
	generateROIs.bleachThreshold = bleachThreshold
	generateROIs.cellROI_2D = generateCellROIs.cellROI_2D
	generateROIs.normalizedTimeSeries = generateNormalizedFrapData.normalizedFrapData
	
generateReducedNormalizedData = GenerateReducedROIData()
	generateReducedNormalizedData.imageTimeSeries = generateNormalizedFrapData.normalizedFrapData
	generateReducedNormalizedData.imageDataROIs = generateROIs.bleachedROI_2D_array
		
computeMeasurementError = ComputeMeasurementError()
	computeMeasurementError.imageDataROIs = generateROIs.bleachedROI_2D_array
	computeMeasurementError.indexFirstPostbleach = generateCellROIs.indexOfFirstPostbleach
	computeMeasurementError.prebleachAverage = generateNormalizedFrapData.prebleachAverage
	computeMeasurementError.rawImageTimeSeries = importVFrap.rawTimeSeriesImages

fitBleachSpot = FitBleachSpot()
	fitBleachSpot.normalizedImages = generateNormalizedFrapData.normalizedFrapData
	fitBleachSpot.bleachROI = generateROIs.bleachedROI_2D


generateUniformDiskModel2 = GenerateKenworthyOptModel()
	generateUniformDiskModel2.bleachRadius = fitBleachSpot.bleachRadius_GaussianFit
	generateUniformDiskModel2.modelType = uniformDisk2ModelName

generate2DOptContextUniformDisk2 = Generate2DOptContext()
	generate2DOptContextUniformDisk2.optModel = generateUniformDiskModel2.optModel
	generate2DOptContextUniformDisk2.normalizedMeasurementErrors = computeMeasurementError.normalizedMeasurementError
	generate2DOptContextUniformDisk2.normExpData = generateReducedNormalizedData.reducedROIData
	
displayInteractiveModel2 = DisplayInteractiveModel()
	displayInteractiveModel2.optContext = generate2DOptContextUniformDisk2.optContext
	displayInteractiveModel2.rois = generateROIs.bleachedROI_2D_array
	displayInteractiveModel2.title = uniformDisk2PanelTitle


generateUniformDiskModel3 = GenerateKenworthyOptModel()
	generateUniformDiskModel3.bleachRadius = fitBleachSpot.bleachRadius_GaussianFit
	generateUniformDiskModel3.modelType = uniformDisk3ModelName	
	generateUniformDiskModel3.prebleachFluor = prebleachFluor

generate2DOptContextUniformDisk3 = Generate2DOptContext()
	generate2DOptContextUniformDisk3.optModel = generateUniformDiskModel3.optModel
	generate2DOptContextUniformDisk3.normalizedMeasurementErrors = computeMeasurementError.normalizedMeasurementError
	generate2DOptContextUniformDisk3.normExpData = generateReducedNormalizedData.reducedROIData

displayInteractiveModel3 = DisplayInteractiveModel()
	displayInteractiveModel3.optContext = generate2DOptContextUniformDisk3.optContext
	displayInteractiveModel3.rois = generateROIs.bleachedROI_2D_array
	displayInteractiveModel3.title = uniformDisk3PanelTitle

