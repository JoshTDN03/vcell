/*
 * Copyright (C) 1999-2011 University of Connecticut Health Center
 *
 * Licensed under the MIT License (the "License").
 * You may not use this file except in compliance with the License.
 * You may obtain a copy of the License at:
 *
 *  http://www.opensource.org/licenses/mit-license.php
 */

package cbit.vcell.messaging.server;
import cbit.vcell.simdata.DataServerImpl;

import java.io.File;
import java.io.FileNotFoundException;

import org.vcell.util.MessageConstants;
import org.vcell.util.PropertyLoader;
import org.vcell.util.SessionLog;

import cbit.vcell.simdata.Cachetable;
import cbit.vcell.simdata.DataSetControllerImpl;
import cbit.vcell.export.server.ExportServiceImpl;

/**
 * This interface was generated by a SmartGuide.
 * 
 */
public class RpcDataServerImpl extends AbstractRpcServerImpl implements cbit.rmi.event.ExportListener,cbit.rmi.event.DataJobListener {
	private DataServerImpl dataServerImpl = null;
	private cbit.vcell.messaging.RpcServerMessaging rpcServerMessaging = null;

/**
 * This method was created by a SmartGuide.
 */
public RpcDataServerImpl (cbit.vcell.messaging.RpcServerMessaging messaging, SessionLog sessionLog) throws FileNotFoundException {
	super(sessionLog);
	rpcServerMessaging = messaging;

	Cachetable cacheTable = new Cachetable(MessageConstants.MINUTE_IN_MS * 20);
	DataSetControllerImpl dataSetControllerImpl = new DataSetControllerImpl(sessionLog, cacheTable, 
			new File(PropertyLoader.getRequiredProperty(PropertyLoader.primarySimDataDirProperty)), 
			new File(PropertyLoader.getRequiredProperty(PropertyLoader.secondarySimDataDirProperty)));
	//add dataJobListener
	dataSetControllerImpl.addDataJobListener(this);
	
	ExportServiceImpl exportServiceImpl = new ExportServiceImpl(log);
	// add export listener
	exportServiceImpl.addExportListener(this);
	
	dataServerImpl = new DataServerImpl(log, dataSetControllerImpl, exportServiceImpl);
}


/**
 * Insert the method's description here.
 * Creation date: (3/31/2006 8:48:04 AM)
 * @param event cbit.rmi.event.ExportEvent
 */
public void dataJobMessage(cbit.rmi.event.DataJobEvent event) {
	try {
		rpcServerMessaging.publishDataStatus(event);
	} catch (javax.jms.JMSException ex) {
		log.exception(ex);
	}
}


/**
 * Insert the method's description here.
 * Creation date: (7/29/2003 10:34:11 AM)
 * @param event cbit.rmi.event.ExportEvent
 */
public void exportMessage(cbit.rmi.event.ExportEvent event) {
	try {
		rpcServerMessaging.publishExportStatus(event);
	} catch (javax.jms.JMSException ex) {
		log.exception(ex);
	}
}


/**
 * Insert the method's description here.
 * Creation date: (3/16/2004 1:02:57 PM)
 * @return java.lang.Object
 */
public java.lang.Object getServerImpl() {
	return dataServerImpl;
}
}
