package cbit.vcell.solvers;
import cbit.vcell.server.*;
import cbit.vcell.solver.*;
import cbit.vcell.server.PropertyLoader;
import java.io.*;

/*©
 * (C) Copyright University of Connecticut Health Center 2001.
 * All rights reserved.
©*/

/**
 * This interface was generated by a SmartGuide.
 * 
 */
public class FVSolverStandalone extends FVSolver implements Solver {
/**
 * This method was created by a SmartGuide.
 * @param mathDesc cbit.vcell.math.MathDescription
 * @param platform cbit.vcell.solvers.Platform
 * @param directory java.lang.String
 * @param simID java.lang.String
 * @param clientProxy cbit.vcell.solvers.ClientProxy
 */
public FVSolverStandalone (SimulationJob argSimulationJob, File dir, SessionLog sessionLog) throws SolverException {
	super(argSimulationJob, dir, sessionLog);
}


/**
 * This method was created by a SmartGuide.
 */
protected void initialize() throws SolverException {
	try {
		initStep1();	
	
		setSolverStatus(new SolverStatus(SolverStatus.SOLVER_RUNNING, "PDESolver initializing"));
		fireSolverStarting("PDESolver initializing...");
	
		setSolverStatus(new SolverStatus(SolverStatus.SOLVER_RUNNING, "Generating input file..."));
			
		File fvinputFile = new File(getSaveDirectory(), cppCoderVCell.getBaseFilename()+".fvinput");
		PrintWriter pw = new PrintWriter(new FileWriter(fvinputFile));
		new FiniteVolumeFileWriter(getSimulationJob(), getSaveDirectory(), pw).write();
		pw.close();
	
		String executableName = PropertyLoader.getRequiredProperty(PropertyLoader.finiteVolumeExecutableProperty);
	
		String cmdline = executableName + " " + fvinputFile.getAbsolutePath();// + cmdArguments;
		setMathExecutable(new MathExecutable(cmdline));
	} catch (Exception ex) {
		ex.printStackTrace(System.out);
		throw new SolverException(ex.getMessage());
	}
}
}